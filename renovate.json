{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "allowPostUpgradeCommandTemplating": true,
  "allowedPostUpgradeCommands": ["^.*"],
  "extends": [
    "config:recommended"
  ],
  "assignees": ["coutug"],
  "flux": {
    "fileMatch": ["app/*.yaml"]
  },
  "customManagers": [
    {
      "customType": "regex",
      "description": "Update chart version",
      "fileMatch": ["^charts/mini-app/Chart.yaml$", "(^|/)Chart\\.ya?ml$"],
      "matchStrings": [
        "version: '?(?<currentValue>[^ '\\n]+)'?",
        "appVersion: '?(?<currentValue>[^ '\\n]+)'?"
      ],
      "depNameTemplate": "ghcr.io/coutug/mini-app",
      "datasourceTemplate": "docker"
    }
  ],
  "packageRules": [
    {
      "matchDatasources": ["docker"],
      "matchPackageNames": ["ghcr.io/coutug/mini-app"],
      "registryUrls": ["ghcr.io"],
      "postUpgradeTasks": {
        "commands": [
          "bash scripts/bump-chart-version.sh '{{{parentDir}}}' '{{{isMajor}}}' '{{{isMinor}}}' '{{{isPatch}}}'"
        ],
        "fileFilters": ["**/Chart.yaml"],
        "executionMode": "branch"
      }
    },
    {
      "matchManagers": ["flux"],
      "matchPackageNames": ["mini-app"]
    }
  ]
}
